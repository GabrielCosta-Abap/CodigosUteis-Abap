FUNCTION z_rfc_zgemm005_detail_items.
*"----------------------------------------------------------------------
*"*"Interface local:
*"  IMPORTING
*"     VALUE(WI_ID) TYPE  SWW_WIID
*"     VALUE(NUM_CARGA_TCF) TYPE  ZBME_NUM_CARGA_TCF
*"  TABLES
*"      T_ITEMS STRUCTURE  ZBMMME2086
*"----------------------------------------------------------------------
  DATA: lr_fields        TYPE REF TO cl_abap_structdescr,
        ls_item          LIKE LINE OF t_items,
        ls_data_fields   TYPE zbmmme2086,
        lt_container     TYPE TABLE OF swr_cont,
        lt_message       TYPE TABLE OF swr_messag,
        lv_mensagem_erro TYPE  syst-lisel,
        lv_json_dados    TYPE  string,
        lv_json_colunas  TYPE  string.

  FIELD-SYMBOLS <lt_data> TYPE ANY TABLE.

  CALL FUNCTION 'SAP_WAPI_READ_CONTAINER'
    EXPORTING
      workitem_id      = wi_id
    TABLES
      simple_container = lt_container
      message_lines    = lt_message.

  DATA(lv_num_carga) = VALUE #( lt_container[ element = 'V_NUM_CARGA_TCF' ]-value OPTIONAL ).

  cl_salv_bs_runtime_info=>set(
    EXPORTING
      display        = abap_false
      metadata       = abap_false
      data           = abap_true
  ).

  CALL FUNCTION 'ZBMMMF077'
    EXPORTING
      i_instid        = lv_num_carga
      i_id            = wi_id
    IMPORTING
      s_mensagem_erro = lv_mensagem_erro
      ev_json_dados   = lv_json_dados
      ev_json_colunas = lv_json_colunas.

  TRY.

      cl_salv_bs_runtime_info=>get_data_ref( IMPORTING r_data = DATA(lr_data) ).

      ASSIGN lr_data->* TO <lt_data>.

    CATCH cx_salv_bs_sc_runtime_info.
      FREE et_entity.
      UNASSIGN <lt_data>.
  ENDTRY.
  cl_salv_bs_runtime_info=>clear_all( ).

  IF <lt_data> IS ASSIGNED.

    lr_fields ?= cl_abap_typedescr=>describe_by_data( ls_data_fields ).

    LOOP AT <lt_data> ASSIGNING FIELD-SYMBOL(<ls_data>).

      LOOP AT lr_fields->components INTO DATA(ls_comp).

        ASSIGN COMPONENT ls_comp-name OF STRUCTURE <ls_data> TO FIELD-SYMBOL(<lv_content>).
        CHECK sy-subrc EQ 0.

        CLEAR ls_item.
        ASSIGN COMPONENT ls_comp-name OF STRUCTURE ls_item TO FIELD-SYMBOL(<lv_item_comp>).
        CHECK sy-subrc EQ 0.
        <lv_item_comp> = <lv_content>.

      ENDLOOP.

      APPEND ls_item TO t_items.

    ENDLOOP.

  ENDLOOP.

ENDFUNCTION.
